<!DOCTYPE html>
<html lang="en" class="lang-en">
  <head>
    <title>go-http-streamer</title>
    <script>
      const originalTitle = document.title;

      function insertData(val) {
        document
          .querySelector("#data")
          .insertAdjacentHTML("afterbegin", `<p>${val}</p>`);
      }

      function poll() {
        const xhr = new XMLHttpRequest();
        xhr.timeout = 1000;

        xhr.onload = () => {
          if (xhr.readyState === xhr.DONE && xhr.status === 200) {
            insertData(`ðŸŸ¢ ${xhr.response}`);
            document.title = `ðŸŸ¢ ${originalTitle}`;
          }
        };

        errFn = () => {
          insertData(`ðŸ”´`);
          document.title = `ðŸ”´ ${originalTitle}`;
        };
        xhr.onabort = errFn;
        xhr.onerror = errFn;
        xhr.ontimeout = errFn;

        xhr.open("GET", "/api/uuid");
        xhr.send();
      }

      setInterval(() => {
        poll();
      }, 1000);
    </script>
  </head>
  <body>
    <div id="data"></div>
  </body>
</html>
